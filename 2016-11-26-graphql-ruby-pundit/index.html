<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>GraphQL Ruby and Authorization With Pundit | Go (Golang) and Data Programming Blog - Nick Poorman</title><meta name=Description content="GraphQL Ruby and Authorization With Pundit"><meta property="og:title" content="GraphQL Ruby and Authorization With Pundit"><meta property="og:description" content="GraphQL Ruby and Authorization With Pundit"><meta property="og:type" content="article"><meta property="og:url" content="https://nickpoorman.com/2016-11-26-graphql-ruby-pundit/"><meta property="article:published_time" content="2016-11-26T05:00:00-05:00"><meta property="article:modified_time" content="2016-11-26T05:00:00-05:00"><meta property="og:site_name" content="Go (Golang) and Data Programming Blog - Nick Poorman"><meta name=twitter:card content="summary"><meta name=twitter:title content="GraphQL Ruby and Authorization With Pundit"><meta name=twitter:description content="GraphQL Ruby and Authorization With Pundit"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel=canonical href=https://nickpoorman.com/2016-11-26-graphql-ruby-pundit/><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=next href=https://nickpoorman.com/2020-03-01-forward/><link rel=stylesheet href=/css/style.min.min.0054a6a76c512b1fd25584a5c9da11f4172b85d18942947eb3b6b51c1cdffded25e7192df37a8dc83c75a16414f32f411bc6a8c5091287650a7856fc3e21e280.css integrity="sha512-AFSmp2xRKx/SVYSlydoR9BcrhdGJQpR+s7a1HBzf/e0l5xkt83qNyDx1oWQU8y9BG8aoxQkSh2UKeFb8PiHigA=="><link rel=preload href=/css/lib/fontawesome-free/all.min.min.4278fa5669f192258c780a19a81f870e1771541b1e3577e6e877875c4b37c2dd4212beadf7de70dbb6e8356e2baa34fdd18bb863f68314ee8e93786da520e646.css integrity="sha512-Qnj6VmnxkiWMeAoZqB+HDhdxVBseNXfm6HeHXEs3wt1CEr6t995w27boNW4rqjT90Yu4Y/aDFO6Ok3htpSDmRg==" as=style onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel=stylesheet href=/css/lib/fontawesome-free/all.min.min.4278fa5669f192258c780a19a81f870e1771541b1e3577e6e877875c4b37c2dd4212beadf7de70dbb6e8356e2baa34fdd18bb863f68314ee8e93786da520e646.css integrity="sha512-Qnj6VmnxkiWMeAoZqB+HDhdxVBseNXfm6HeHXEs3wt1CEr6t995w27boNW4rqjT90Yu4Y/aDFO6Ok3htpSDmRg=="></noscript><link rel=preload href=/css/lib/lightbox/lightbox.min.min.bf8656e5153249529326f4eda9239f27fb215f7add3d1593211302d86fd0ff4ae5c46101dfeb7cc31f88da8e5ec125a383057cf718e9d6e69721868777fcd26f.css integrity="sha512-v4ZW5RUySVKTJvTtqSOfJ/shX3rdPRWTIRMC2G/Q/0rlxGEB3+t8wx+I2o5ewSWjgwV89xjp1uaXIYaHd/zSbw==" as=style onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel=stylesheet href=/css/lib/lightbox/lightbox.min.min.bf8656e5153249529326f4eda9239f27fb215f7add3d1593211302d86fd0ff4ae5c46101dfeb7cc31f88da8e5ec125a383057cf718e9d6e69721868777fcd26f.css integrity="sha512-v4ZW5RUySVKTJvTtqSOfJ/shX3rdPRWTIRMC2G/Q/0rlxGEB3+t8wx+I2o5ewSWjgwV89xjp1uaXIYaHd/zSbw=="></noscript><meta name=p:domain_verify content="e820434c419f4c0782c7916de63ecb60"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"GraphQL Ruby and Authorization With Pundit","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/nickpoorman.com\/2016-11-26-graphql-ruby-pundit\/"},"image":{"@type":"ImageObject","url":"https:\/\/nickpoorman.com\/cover.png","width":800,"height":600},"genre":"posts","keywords":"GraphQL, Ruby, Pundit","wordcount":385,"url":"https:\/\/nickpoorman.com\/2016-11-26-graphql-ruby-pundit\/","datePublished":"2016-11-26T05:00:00-05:00","dateModified":"2016-11-26T05:00:00-05:00","publisher":{"@type":"Organization","name":"Nick Poorman","logo":{"@type":"ImageObject","url":"https:\/\/nickpoorman.com\/logo.png","width":127,"height":40}},"description":"GraphQL Ruby and Authorization With Pundit"}</script></head><body><script>if(!window.localStorage||!window.localStorage.getItem('theme')){window.isDark=window.matchMedia('(prefers-color-scheme: dark)').matches;}else{window.isDark=(window.localStorage&&window.localStorage.getItem('theme'))==='dark';}
window.isDark&&document.body.classList.add('dark-theme');</script><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/>Intersection of Go and Data</a></div><div class=menu><a class=menu-item href=/posts/ title="list of blog posts">Posts</a><a class=menu-item href=/tags/ title="list of article tags">Tags</a><a class=menu-item href=/about/ title="Nick Poorman about page">About</a><a href=javascript:void(0); class=theme-switch title="Switch website theme to Dark mode" aria-label="Switch website theme to Dark mode">
<i class="fas fa-adjust fa-rotate-180 fa-fw"></i></a></div></div></header><header class=mobile id=header-mobile><div class=header-wrapper><div class=header-container><div class=header-title><a href=/>Intersection of Go and Data</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/posts/ title="list of blog posts">Posts</a><a class=menu-item href=/tags/ title="list of article tags">Tags</a><a class=menu-item href=/about/ title="Nick Poorman about page">About</a><a href=javascript:void(0); class=theme-switch title="Switch website theme to Dark mode" aria-label="Switch website theme to Dark mode">
<i class="fas fa-adjust fa-rotate-180 fa-fw"></i></a></div></div></header><script>window.desktopHeaderMode="fixed";window.mobileHeaderMode="auto";</script><main class=main><div class=container><article class="page single"><h1 class=single-title>GraphQL Ruby and Authorization With Pundit</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a class=author href=/ rel=author target=_blank><i class="fas fa-user-circle fa-fw"></i>Nick Poorman</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i><time datetime=2016-11-26>2016-11-26</time>&nbsp;
<i class="fas fa-pencil-alt fa-fw"></i>about 385 words&nbsp;
<i class="far fa-clock fa-fw"></i>2 min&nbsp;</div></div><div class=content><p>Recently I began exploring GraphQL for use with Ruby on Rails. There is an
excellent gem <code>graphql</code> created by <a href=https://github.com/rmosolgo target=_blank rel="noopener noreffer">Robert
Mosolgo</a>
, that provides all the workings of
GraphQL <a href=https://github.com/rmosolgo/graphql-ruby>https://github.com/rmosolgo/graphql-ruby</a>. Notably is the excellent
documentation accompanying this gem <a href=https://rmosolgo.github.io/graphql-ruby>https://rmosolgo.github.io/graphql-ruby</a>.</p><p>With all the documentation you should easily be able to get up and running with
GraphQL in Ruby. However, authorizing user access to records via
<a href=https://github.com/varvet/pundit target=_blank rel="noopener noreffer">Pundit</a>
may require a bit of exploration,
seeing as it&rsquo;s original intended purpose is to authenticate by controller
actions. I&rsquo;m going to quickly outline how I achieved this with a few code
snippets. First add <a href=https://github.com/varvet/pundit target=_blank rel="noopener noreffer">Pundit</a>
to you gemfile:
<code>gem 'pundit</code>.</p><p>Then in your <code>Application Controller</code>:</p><script type=application/javascript src=https://gist.github.com/nickpoorman/cbd39734fbdcc66049a69d5309844045.js></script><p>Now you&rsquo;ll need a controller to serve the GraphQL queries. Let&rsquo;s call it
<code>graphql_controller.rb</code>. As you can see below, <code>GraphqlController</code> inherits from
<code>ApplicationController</code>, thus giving us
<a href=https://github.com/varvet/pundit target=_blank rel="noopener noreffer">Pundit</a>
capabilities. To make things simple,
we have passed in a context with the <code>current_user</code> and <code>pundit</code> -which will
give us access to the Pundit <code>authorize</code> method in the GraphQL handlers. Also,
by passing the instance of the controller into the context, we are able to add
<code>after_action :verify_authorized</code> to <a href=https://github.com/varvet/pundit#ensuring-policies-and-scopes-are-used target=_blank rel="noopener noreffer">ensure policies and scopes are
used</a>
somewhere in the GraphQL handlers.</p><script type=application/javascript src=https://gist.github.com/nickpoorman/41d431a9be23838a1d9bba5f5f83dfdb.js></script><p>Next, if you&rsquo;re using Relay you should put a Pundit <code>authorize</code> in your schema
where you decode the object id. You can see that we have used the <code>pundit</code>
instance passed into the context (<code>ctx</code>). Because we are simply looking up a
record here, we have decided to use the <code>:show</code> policy action.</p><script type=application/javascript src=https://gist.github.com/nickpoorman/0f90dc9ef84f476afe79a4b47485cb01.js></script><p>If you happen to come across this <a href=https://github.com/rmosolgo/graphql-ruby-demo target=_blank rel="noopener noreffer">demo
app</a>
, you’ll notice an
<a href=https://github.com/rmosolgo/graphql-ruby-demo/blob/master/app/graph/fields/fetch_field.rb target=_blank rel="noopener noreffer">abstraction for fetching
records</a>
called <code>FetchFeild</code>. I’ll add an example below in case you also have chosen this
route. In the <code>resolve</code> method below, we add in a Pundit <code>authorize</code> call to
ensure the user has access to the record that is being fetched. Pundit will
automatically lookup the policy by model name (class name) and authorize
accordingly.</p><script type=application/javascript src=https://gist.github.com/nickpoorman/d9cbdcb44f6deaf46ae3426ef13afd9c.js></script><p>Lastly, when doing mutations (or even queries), you’ll need to add your
authorization to create or update the record. Below we have a mutation to create
a Post. We add the <code>authorize</code> call in the <code>resolve</code> proc. Note that we are
using a <a href=https://github.com/varvet/pundit#headless-policies target=_blank rel="noopener noreffer">headless policy for
Pundit</a>
here: i.e.
<code>authorize :post</code>.</p><script type=application/javascript src=https://gist.github.com/nickpoorman/968aa61452b22e75a057e3d46414191b.js></script><p>Hopefully this will get you moving along with Pundit authorization a bit faster.</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>The article was updated on 2016-11-26</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=https://nickpoorman.com/2016-11-26-graphql-ruby-pundit/index.md target=_blank>Read Markdown</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=https://nickpoorman.com/2016-11-26-graphql-ruby-pundit/ data-title="GraphQL Ruby and Authorization With Pundit" data-via=nickpoorman data-hashtags=GraphQL,Ruby,Pundit><i class="fab fa-twitter fa-fw"></i></a><a href=javascript:void(0); title="Share on Linkedin" data-sharer=linkedin data-url=https://nickpoorman.com/2016-11-26-graphql-ruby-pundit/><i class="fab fa-linkedin fa-fw"></i></a><a href=javascript:void(0); title="Share on Hacker News" data-sharer=hackernews data-url=https://nickpoorman.com/2016-11-26-graphql-ruby-pundit/ data-title="GraphQL Ruby and Authorization With Pundit"><i class="fab fa-hacker-news fa-fw"></i></a><a href=javascript:void(0); title="Share on Reddit" data-sharer=reddit data-url=https://nickpoorman.com/2016-11-26-graphql-ruby-pundit/><i class="fab fa-reddit fa-fw"></i></a></span></div></div></div><div class=post-info-more><section><span><a href=/tags/graphql><i class="fas fa-tag fa-fw"></i>GraphQL</a>
</span>&nbsp;<span>
<a href=/tags/ruby><i class="fas fa-tag fa-fw"></i>Ruby</a>
</span>&nbsp;<span>
<a href=/tags/pundit><i class="fas fa-tag fa-fw"></i>Pundit</a>
</span>&nbsp;</section><section><span><a href=javascript:window.history.back();>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=https://nickpoorman.com/2020-03-01-forward/ class=next rel=next title=Forward>Forward<i class="fas fa-angle-right fa-fw"></i></a></div></div><div class=comment></div></article></div></main><footer class=footer><div class=copyright><div class=copyright-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2020</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>Nick Poorman</a></span></div></div></footer></div><a href=# class="dynamic-to-top animated faster" id=dynamic-to-top><span>&nbsp;</span>
</a><script>var AsyncLoader={domLoaded:false,waitingFiles:["js/theme.min.js","js\/lib\/smooth-scroll\/smooth-scroll.polyfills.min.js","js\/lib\/sharer\/sharer.min.js","js\/lib\/lazysizes\/lazysizes.min.js",],waitCount:0,complete:function(){if(typeof _loadKatex==="function"){_loadKatex()}
if(typeof window.themeLoaded=="function"){window.themeLoaded()}},}
AsyncLoader.waitCount=AsyncLoader.waitingFiles.length
document.addEventListener("DOMContentLoaded",function(){AsyncLoader.domLoaded=true});AsyncLoader.asyncFileLoaded=function(src){if(AsyncLoader.waitingFiles.indexOf(src)>=0){AsyncLoader.waitCount--;}
if(!!AsyncLoader.waitCount){return}
if(AsyncLoader.domLoaded){AsyncLoader.complete()}else{document.addEventListener("DOMContentLoaded",function(){AsyncLoader.complete()});}}</script><script async src=/js/bundle-scriptLocal.min.a907d4882377eaac04a576852904325e80d40262e86d92cfb6b688c368cda3f2e9d588b0f0d94a3b68998c36c96942227e7966d003e0c2a194cba1f2cf205436.js integrity="sha512-qQfUiCN36qwEpXaFKQQyXoDUAmLobZLPtraIw2jNo/Lp1Yiw8NlKO2iZjDbJaUIifnlm0APgwqGUy6HyzyBUNg==" onload='this.onload=null;AsyncLoader.asyncFileLoaded({"Content":"\u003cp\u003eRecently I began exploring GraphQL for use with Ruby on Rails. There is an\nexcellent gem \u003ccode\u003egraphql\u003c/code\u003e created by \u003ca href=\"https://github.com/rmosolgo\" target=\"_blank\" rel=\"noopener noreffer\"\u003eRobert\nMosolgo\u003c/a\u003e\n, that provides all the workings of\nGraphQL \u003ca href=\"https://github.com/rmosolgo/graphql-ruby\"\u003ehttps://github.com/rmosolgo/graphql-ruby\u003c/a\u003e. Notably is the excellent\ndocumentation accompanying this gem \u003ca href=\"https://rmosolgo.github.io/graphql-ruby\"\u003ehttps://rmosolgo.github.io/graphql-ruby\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eWith all the documentation you should easily be able to get up and running with\nGraphQL in Ruby. However, authorizing user access to records via\n\u003ca href=\"https://github.com/varvet/pundit\" target=\"_blank\" rel=\"noopener noreffer\"\u003ePundit\u003c/a\u003e\n may require a bit of exploration,\nseeing as it\u0026rsquo;s original intended purpose is to authenticate by controller\nactions. I\u0026rsquo;m going to quickly outline how I achieved this with a few code\nsnippets. First add \u003ca href=\"https://github.com/varvet/pundit\" target=\"_blank\" rel=\"noopener noreffer\"\u003ePundit\u003c/a\u003e\n to you gemfile:\n\u003ccode\u003egem &#39;pundit\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eThen in your \u003ccode\u003eApplication Controller\u003c/code\u003e:\u003c/p\u003e\n\u003cscript type=\"application/javascript\" src=\"https://gist.github.com/nickpoorman/cbd39734fbdcc66049a69d5309844045.js\"\u003e\u003c/script\u003e\n\n\u003cp\u003eNow you\u0026rsquo;ll need a controller to serve the GraphQL queries. Let\u0026rsquo;s call it\n\u003ccode\u003egraphql_controller.rb\u003c/code\u003e. As you can see below, \u003ccode\u003eGraphqlController\u003c/code\u003e inherits from\n\u003ccode\u003eApplicationController\u003c/code\u003e, thus giving us\n\u003ca href=\"https://github.com/varvet/pundit\" target=\"_blank\" rel=\"noopener noreffer\"\u003ePundit\u003c/a\u003e\n capabilities. To make things simple,\nwe have passed in a context with the \u003ccode\u003ecurrent_user\u003c/code\u003e and \u003ccode\u003epundit\u003c/code\u003e -which will\ngive us access to the Pundit \u003ccode\u003eauthorize\u003c/code\u003e method in the GraphQL handlers. Also,\nby passing the instance of the controller into the context, we are able to add\n\u003ccode\u003eafter_action :verify_authorized\u003c/code\u003e to \u003ca href=\"https://github.com/varvet/pundit#ensuring-policies-and-scopes-are-used\" target=\"_blank\" rel=\"noopener noreffer\"\u003eensure policies and scopes are\nused\u003c/a\u003e\n\nsomewhere in the GraphQL handlers.\u003c/p\u003e\n\u003cscript type=\"application/javascript\" src=\"https://gist.github.com/nickpoorman/41d431a9be23838a1d9bba5f5f83dfdb.js\"\u003e\u003c/script\u003e\n\n\u003cp\u003eNext, if you\u0026rsquo;re using Relay you should put a Pundit \u003ccode\u003eauthorize\u003c/code\u003e in your schema\nwhere you decode the object id. You can see that we have used the \u003ccode\u003epundit\u003c/code\u003e\ninstance passed into the context (\u003ccode\u003ectx\u003c/code\u003e). Because we are simply looking up a\nrecord here, we have decided to use the \u003ccode\u003e:show\u003c/code\u003e policy action.\u003c/p\u003e\n\u003cscript type=\"application/javascript\" src=\"https://gist.github.com/nickpoorman/0f90dc9ef84f476afe79a4b47485cb01.js\"\u003e\u003c/script\u003e\n\n\u003cp\u003eIf you happen to come across this \u003ca href=\"https://github.com/rmosolgo/graphql-ruby-demo\" target=\"_blank\" rel=\"noopener noreffer\"\u003edemo\napp\u003c/a\u003e\n, you’ll notice an\n\u003ca href=\"https://github.com/rmosolgo/graphql-ruby-demo/blob/master/app/graph/fields/fetch_field.rb\" target=\"_blank\" rel=\"noopener noreffer\"\u003eabstraction for fetching\nrecords\u003c/a\u003e\n\ncalled \u003ccode\u003eFetchFeild\u003c/code\u003e. I’ll add an example below in case you also have chosen this\nroute. In the \u003ccode\u003eresolve\u003c/code\u003e method below, we add in a Pundit \u003ccode\u003eauthorize\u003c/code\u003e call to\nensure the user has access to the record that is being fetched. Pundit will\nautomatically lookup the policy by model name (class name) and authorize\naccordingly.\u003c/p\u003e\n\u003cscript type=\"application/javascript\" src=\"https://gist.github.com/nickpoorman/d9cbdcb44f6deaf46ae3426ef13afd9c.js\"\u003e\u003c/script\u003e\n\n\u003cp\u003eLastly, when doing mutations (or even queries), you’ll need to add your\nauthorization to create or update the record. Below we have a mutation to create\na Post. We add the \u003ccode\u003eauthorize\u003c/code\u003e call in the \u003ccode\u003eresolve\u003c/code\u003e proc. Note that we are\nusing a \u003ca href=\"https://github.com/varvet/pundit#headless-policies\" target=\"_blank\" rel=\"noopener noreffer\"\u003eheadless policy for\nPundit\u003c/a\u003e\n here: i.e.\n\u003ccode\u003eauthorize :post\u003c/code\u003e.\u003c/p\u003e\n\u003cscript type=\"application/javascript\" src=\"https://gist.github.com/nickpoorman/968aa61452b22e75a057e3d46414191b.js\"\u003e\u003c/script\u003e\n\n\u003cp\u003eHopefully this will get you moving along with Pundit authorization a bit faster.\u003c/p\u003e\n","Plain":"Recently I began exploring GraphQL for use with Ruby on Rails. There is an excellent gem graphql created by Robert Mosolgo , that provides all the workings of GraphQL https://github.com/rmosolgo/graphql-ruby. Notably is the excellent documentation accompanying this gem https://rmosolgo.github.io/graphql-ruby.\nWith all the documentation you should easily be able to get up and running with GraphQL in Ruby. However, authorizing user access to records via Pundit may require a bit of exploration, seeing as it\u0026rsquo;s original intended purpose is to authenticate by controller actions. I\u0026rsquo;m going to quickly outline how I achieved this with a few code snippets. First add Pundit to you gemfile: gem &#39;pundit.\nThen in your Application Controller:\n Now you\u0026rsquo;ll need a controller to serve the GraphQL queries. Let\u0026rsquo;s call it graphql_controller.rb. As you can see below, GraphqlController inherits from ApplicationController, thus giving us Pundit capabilities. To make things simple, we have passed in a context with the current_user and pundit -which will give us access to the Pundit authorize method in the GraphQL handlers. Also, by passing the instance of the controller into the context, we are able to add after_action :verify_authorized to ensure policies and scopes are used somewhere in the GraphQL handlers.\n Next, if you\u0026rsquo;re using Relay you should put a Pundit authorize in your schema where you decode the object id. You can see that we have used the pundit instance passed into the context (ctx). Because we are simply looking up a record here, we have decided to use the :show policy action.\n If you happen to come across this demo app , you’ll notice an abstraction for fetching records called FetchFeild. I’ll add an example below in case you also have chosen this route. In the resolve method below, we add in a Pundit authorize call to ensure the user has access to the record that is being fetched. Pundit will automatically lookup the policy by model name (class name) and authorize accordingly.\n Lastly, when doing mutations (or even queries), you’ll need to add your authorization to create or update the record. Below we have a mutation to create a Post. We add the authorize call in the resolve proc. Note that we are using a headless policy for Pundit here: i.e. authorize :post.\n Hopefully this will get you moving along with Pundit authorization a bit faster.\n","PlainWords":["Recently","I","began","exploring","GraphQL","for","use","with","Ruby","on","Rails.","There","is","an","excellent","gem","graphql","created","by","Robert","Mosolgo",",","that","provides","all","the","workings","of","GraphQL","https://github.com/rmosolgo/graphql-ruby.","Notably","is","the","excellent","documentation","accompanying","this","gem","https://rmosolgo.github.io/graphql-ruby.","With","all","the","documentation","you","should","easily","be","able","to","get","up","and","running","with","GraphQL","in","Ruby.","However,","authorizing","user","access","to","records","via","Pundit","may","require","a","bit","of","exploration,","seeing","as","it\u0026rsquo;s","original","intended","purpose","is","to","authenticate","by","controller","actions.","I\u0026rsquo;m","going","to","quickly","outline","how","I","achieved","this","with","a","few","code","snippets.","First","add","Pundit","to","you","gemfile:","gem","&#39;pundit.","Then","in","your","Application","Controller:","Now","you\u0026rsquo;ll","need","a","controller","to","serve","the","GraphQL","queries.","Let\u0026rsquo;s","call","it","graphql_controller.rb.","As","you","can","see","below,","GraphqlController","inherits","from","ApplicationController,","thus","giving","us","Pundit","capabilities.","To","make","things","simple,","we","have","passed","in","a","context","with","the","current_user","and","pundit","-which","will","give","us","access","to","the","Pundit","authorize","method","in","the","GraphQL","handlers.","Also,","by","passing","the","instance","of","the","controller","into","the","context,","we","are","able","to","add","after_action",":verify_authorized","to","ensure","policies","and","scopes","are","used","somewhere","in","the","GraphQL","handlers.","Next,","if","you\u0026rsquo;re","using","Relay","you","should","put","a","Pundit","authorize","in","your","schema","where","you","decode","the","object","id.","You","can","see","that","we","have","used","the","pundit","instance","passed","into","the","context","(ctx).","Because","we","are","simply","looking","up","a","record","here,","we","have","decided","to","use","the",":show","policy","action.","If","you","happen","to","come","across","this","demo","app",",","you’ll","notice","an","abstraction","for","fetching","records","called","FetchFeild.","I’ll","add","an","example","below","in","case","you","also","have","chosen","this","route.","In","the","resolve","method","below,","we","add","in","a","Pundit","authorize","call","to","ensure","the","user","has","access","to","the","record","that","is","being","fetched.","Pundit","will","automatically","lookup","the","policy","by","model","name","(class","name)","and","authorize","accordingly.","Lastly,","when","doing","mutations","(or","even","queries),","you’ll","need","to","add","your","authorization","to","create","or","update","the","record.","Below","we","have","a","mutation","to","create","a","Post.","We","add","the","authorize","call","in","the","resolve","proc.","Note","that","we","are","using","a","headless","policy","for","Pundit","here:","i.e.","authorize",":post.","Hopefully","this","will","get","you","moving","along","with","Pundit","authorization","a","bit","faster."],"Summary":"Setting up GraphQL Ruby with Pundit","Truncated":false,"FuzzyWordCount":400,"WordCount":385,"ReadingTime":2,"Len":4289,"TableOfContents":"\u003cnav id=\"TableOfContents\"\u003e\u003c/nav\u003e","RawContent":"\nRecently I began exploring GraphQL for use with Ruby on Rails. There is an\nexcellent gem `graphql` created by [Robert\nMosolgo](https://github.com/rmosolgo), that provides all the workings of\nGraphQL https://github.com/rmosolgo/graphql-ruby. Notably is the excellent\ndocumentation accompanying this gem https://rmosolgo.github.io/graphql-ruby.\n\nWith all the documentation you should easily be able to get up and running with\nGraphQL in Ruby. However, authorizing user access to records via\n[Pundit](https://github.com/varvet/pundit) may require a bit of exploration,\nseeing as it&#39;s original intended purpose is to authenticate by controller\nactions. I&#39;m going to quickly outline how I achieved this with a few code\nsnippets. First add [Pundit](https://github.com/varvet/pundit) to you gemfile:\n`gem &#39;pundit`.\n\nThen in your `Application Controller`:\n\n{{\u003c gist nickpoorman cbd39734fbdcc66049a69d5309844045 \u003e}}\n\nNow you&#39;ll need a controller to serve the GraphQL queries. Let&#39;s call it\n`graphql_controller.rb`. As you can see below, `GraphqlController` inherits from\n`ApplicationController`, thus giving us\n[Pundit](https://github.com/varvet/pundit) capabilities. To make things simple,\nwe have passed in a context with the `current_user` and `pundit` -which will\ngive us access to the Pundit `authorize` method in the GraphQL handlers. Also,\nby passing the instance of the controller into the context, we are able to add\n`after_action :verify_authorized` to [ensure policies and scopes are\nused](https://github.com/varvet/pundit#ensuring-policies-and-scopes-are-used)\nsomewhere in the GraphQL handlers.\n\n{{\u003c gist nickpoorman 41d431a9be23838a1d9bba5f5f83dfdb \u003e}}\n\nNext, if you&#39;re using Relay you should put a Pundit `authorize` in your schema\nwhere you decode the object id. You can see that we have used the `pundit`\ninstance passed into the context (`ctx`). Because we are simply looking up a\nrecord here, we have decided to use the `:show` policy action.\n\n{{\u003c gist nickpoorman 0f90dc9ef84f476afe79a4b47485cb01 \u003e}}\n\nIf you happen to come across this [demo\napp](https://github.com/rmosolgo/graphql-ruby-demo), you’ll notice an\n[abstraction for fetching\nrecords](https://github.com/rmosolgo/graphql-ruby-demo/blob/master/app/graph/fields/fetch_field.rb)\ncalled `FetchFeild`. I’ll add an example below in case you also have chosen this\nroute. In the `resolve` method below, we add in a Pundit `authorize` call to\nensure the user has access to the record that is being fetched. Pundit will\nautomatically lookup the policy by model name (class name) and authorize\naccordingly.\n\n{{\u003c gist nickpoorman d9cbdcb44f6deaf46ae3426ef13afd9c \u003e}}\n\nLastly, when doing mutations (or even queries), you’ll need to add your\nauthorization to create or update the record. Below we have a mutation to create\na Post. We add the `authorize` call in the `resolve` proc. Note that we are\nusing a [headless policy for\nPundit](https://github.com/varvet/pundit#headless-policies) here: i.e.\n`authorize :post`.\n\n{{\u003c gist nickpoorman 968aa61452b22e75a057e3d46414191b \u003e}}\n\nHopefully this will get you moving along with Pundit authorization a bit faster.\n","MediaType":{"type":"application/octet-stream","string":"application/octet-stream","mainType":"application","subType":"octet-stream","delimiter":"","suffixes":null},"ResourceType":"page","Permalink":"https://nickpoorman.com/2016-11-26-graphql-ruby-pundit/","RelPermalink":"/2016-11-26-graphql-ruby-pundit/","Name":"GraphQL Ruby and Authorization With Pundit","Title":"GraphQL Ruby and Authorization With Pundit","Params":{"author":"Nick Poorman","autocollapsetoc":true,"comment":true,"date":"2016-11-26T05:00:00-05:00","description":"GraphQL Ruby and Authorization With Pundit","draft":false,"featuredimage":"","featuredimagepreview":"","hiddenfromhomepage":false,"iscjklanguage":false,"lastmod":"2016-11-26T05:00:00-05:00","license":"","math":false,"publishdate":"2016-11-26T05:00:00-05:00","summary":"Setting up GraphQL Ruby with Pundit","tags":["GraphQL","Ruby","Pundit"],"title":"GraphQL Ruby and Authorization With Pundit","toc":false},"Data":{},"Date":"2016-11-26T05:00:00-05:00","Lastmod":"2016-11-26T05:00:00-05:00","PublishDate":"2016-11-26T05:00:00-05:00","ExpiryDate":"0001-01-01T00:00:00Z","Aliases":null,"BundleType":"leaf","Description":"GraphQL Ruby and Authorization With Pundit","Draft":false,"IsHome":false,"Keywords":null,"Kind":"page","Layout":"","LinkTitle":"GraphQL Ruby and Authorization With Pundit","IsNode":false,"IsPage":true,"Path":"posts/2016-11-26-graphql-ruby-pundit/index.md","Slug":"","Lang":"en","IsSection":false,"Section":"posts","SectionsEntries":["posts"],"SectionsPath":"posts","Sitemap":{"ChangeFreq":"weekly","Priority":0.5,"Filename":"sitemap.xml"},"Type":"posts","Weight":0,"Language":{"Lang":"en","LanguageName":"","Title":"Go (Golang) and Data Programming Blog - Nick Poorman","Weight":1,"Disabled":false,"ContentDir":"","Cfg":{}},"File":{"File":{}},"GitInfo":null,"OutputFormats":[{"Rel":"canonical","Format":{"MediaType":"text/html","name":"HTML","mediaType":{"type":"text/html","string":"text/html","mainType":"text","subType":"html","delimiter":".","suffixes":["html"]},"path":"","baseName":"index","rel":"canonical","protocol":"","isPlainText":false,"isHTML":true,"noUgly":false,"notAlternative":false,"permalinkable":true,"weight":10}},{"Rel":"alternate","Format":{"MediaType":"text/plain","name":"markdown","mediaType":{"type":"text/plain","string":"text/plain","mainType":"text","subType":"plain","delimiter":".","suffixes":["md"]},"path":"","baseName":"index","rel":"alternate","protocol":"","isPlainText":true,"isHTML":false,"noUgly":false,"notAlternative":false,"permalinkable":false,"weight":0}}],"AlternativeOutputFormats":[{"Rel":"alternate","Format":{"MediaType":"text/plain","name":"markdown","mediaType":{"type":"text/plain","string":"text/plain","mainType":"text","subType":"plain","delimiter":".","suffixes":["md"]},"path":"","baseName":"index","rel":"alternate","protocol":"","isPlainText":true,"isHTML":false,"noUgly":false,"notAlternative":false,"permalinkable":false,"weight":0}}],"Menus":null,"TranslationKey":"page/posts/2016-11-26-graphql-ruby-pundit/index","IsTranslated":false,"AllTranslations":null,"Translations":null})'></script><script async src=/js/theme.min.js onload="this.onload=null;AsyncLoader.asyncFileLoaded('js/theme.min.js')"></script><script async src=/js/lightbox-plus-jquery.min.js></script></body></html>